.include "m32def.inc"
		; Mohammadmostafa Rostamkhani - student number: 97521306
		;Initialize Stack Pointer
		LDI		R16,HIGH(RAMEND)
		OUT		SPH,R16
		LDI		R16,LOW(RAMEND)
		OUT		SPL,R16

		;Initialize PORTC as OUTPUT
		LDI		R16,0xFF
		OUT		DDRC,R16

		;Initialize Low Nibble of PORTD as OUTPUT
		LDI		R16,0x0F
		OUT		DDRD,R16

		;Initialize 0000 in 7seg
		LDI		R21,0
		LDI		R22,0
		LDI		R23,0
		LDI		R24,0
		LDI		R25,15

BEGIN:
		; load xxx0 in R21
		LDI		R16,0b11110111
		OUT		PORTD,R16
		MOV		R16,R21
		CALL	CONVERT
		OUT		PORTC,R16
		CALL	DELAY

		; load xx0x in R22
		LDI		R16,0b11111011
		OUT		PORTD,R16
		MOV		R16,R22
		CALL	CONVERT
		OUT		PORTC,R16
		CALL	DELAY

		; load x0xx in R23
		LDI		R16,0b11111101
		OUT		PORTD,R16
		MOV		R16,R23
		CALL	CONVERT
		OUT		PORTC,R16
		CALL	DELAY

		; load 0xxx in R24
		LDI		R16,0b11111110
		OUT		PORTD,R16
		MOV		R16,R24
		CALL	CONVERT
		OUT		PORTC,R16
		CALL	DELAY

		DEC		R25
		BRNE	BEGIN
		LDI		R25,15

		IN		R16,PINA
		CPI		R16,0
		BRNE	DECREASE


		; increase
		INC		R21
		CPI		R21,10
		BREQ	INC1

		RJMP	BEGIN

INC1:
		LDI 	R21,0
		INC		R22
		CPI		R22,10
		BREQ	INC2
		RJMP	BEGIN
INC2:
		LDI		R22,0
		INC		R23
		CPI		R23,10
		BREQ	INC3
		RJMP	BEGIN
INC3:
		LDI		R23,0
		INC		R24
		CPI		R24,10
		BREQ	SET0
		RJMP	BEGIN
SET0:
		LDI		R21,0
		LDI		R22,0
		LDI		R23,0
		LDI		R24,0
		RJMP	BEGIN

SET9:
		LDI		R21,9
		LDI		R22,9
		LDI		R23,9
		LDI		R24,9
		RJMP	BEGIN

DECREASE:
		; decrease
		DEC		R21
		CPI		R21,-1
		BREQ	DEC1
		RJMP	BEGIN

DEC1:
		LDI 	R21,9
		DEC		R22
		CPI		R22,-1
		BREQ	DEC2
		RJMP	BEGIN
DEC2:
		LDI		R22,9
		DEC		R23
		CPI		R23,-1
		BREQ	DEC3
		RJMP	BEGIN
DEC3:
		LDI		R23,9
		DEC		R24
		CPI		R24,-1
		BREQ	SET9
		RJMP	BEGIN



DELAY:	LDI		R17,0x1
L1:		LDI		R18,0x11
L2:		LDI		R19,0xFF
L3:		DEC		R19
		BRNE	L3
		DEC		R18
		BRNE	L2
		DEC		R17
		BRNE	L1
		RET

CONVERT:
		CPI		R16,0
		BRNE	C1
		LDI		R16,0x3F
		RET
C1:		CPI		R16,1
		BRNE	C2
		LDI		R16,0x06
		RET
C2:		CPI		R16,2
		BRNE	C3
		LDI		R16,0x5B
		RET
C3:		CPI		R16,3
		BRNE	C4
		LDI		R16,0x4F
		RET
C4:		CPI		R16,4
		BRNE	C5
		LDI		R16,0x66
		RET
C5:		CPI		R16,5
		BRNE	C6
		LDI		R16,0x6D
		RET
C6:		CPI		R16,6
		BRNE	C7
		LDI		R16,0x7D
		RET
C7:		CPI		R16,7
		BRNE	C8
		LDI		R16,0x07
		RET
C8:		CPI		R16,8
		BRNE	C9
		LDI		R16,0x7F
		RET
C9:		CPI		R16,9
		BRNE	C10
		LDI		R16,0x6F
C10:	RET

